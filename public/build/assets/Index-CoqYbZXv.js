import{d as ae,n as de,c as r,r as i,q as re,a as ie,o as n,w as ue,m as pe,b as s,u as J,s as me,e as l,f as g,g as u,W as C,F as p,i as m,t as a,v as _,h as D,k as F,j as ve}from"./app-0xfeTETD.js";import{_ as ce}from"./AppLayout.vue_vue_type_script_setup_true_lang-Czkn1H1y.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BRkfCIi1.js";import"./index-1Zo7FGYr.js";const ge={class:"p-6 space-y-4"},be={class:"flex flex-wrap items-center justify-between gap-3"},xe={class:"flex items-center gap-2"},fe={class:"text-sm flex items-center gap-2"},ye={key:0,value:"2025-2"},_e={key:1,value:"2026-0"},ke={key:2,value:"2026-1"},Se=["value"],we={key:0,class:"border rounded-xl bg-card p-4"},he={class:"grid gap-3 md:grid-cols-2"},Ce={class:"text-sm"},Ve=["value"],Ae={class:"text-sm"},Ue=["value"],Re={class:"text-sm"},Me=["value"],$e={class:"text-sm"},je=["value"],ze={class:"text-sm md:col-span-2"},De={class:"mt-3 flex justify-end"},Ne=["disabled"],Pe={key:1,class:"text-sm text-muted-foreground"},Be={key:2,class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},Ie={class:"space-y-1"},Ee={class:"font-semibold text-sm md:text-base"},Fe={class:"text-xs text-muted-foreground"},Le={class:"font-medium text-foreground"},Oe={class:"text-xs text-muted-foreground"},Te={class:"font-medium text-foreground"},We={class:"text-xs text-muted-foreground"},qe={class:"font-medium text-foreground"},Ge={class:"mt-3 flex items-center justify-between"},He={class:"flex items-center gap-2"},Je=["onClick"],Ke=["onClick"],Qe=["onClick"],Xe={key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40"},Ye={class:"bg-card border rounded-xl shadow-xl max-w-2xl w-full p-4 space-y-4"},Ze={class:"flex justify-between items-start gap-2"},et={class:"text-xs text-muted-foreground"},tt={class:"space-y-2"},st={class:"block text-sm"},ot={label:"Docentes"},nt=["value"],lt={key:0,label:"Responsables / Admin"},at=["value"],dt={class:"block text-sm"},rt=["value"],it={class:"block text-sm"},ut=["value"],pt={class:"block text-sm"},mt={class:"flex justify-end gap-2"},vt=["disabled"],yt=ae({__name:"Index",setup(ct){const v=de(),K=[{title:"Dashboard",href:"/dashboard"},{title:"Responsabilidades",href:"/responsabilidades"}],V=r(()=>v.props.cursos??[]),Q=r(()=>v.props.responsables??[]),N=r(()=>v.props.docentes??[]),X=r(()=>v.props.filters??{}),A=r(()=>v.props.periodosCatalog??[]),L=r(()=>v.props.sedesCatalog??[]),U=r(()=>{var o,e;return((e=(o=v.props.auth)==null?void 0:o.user)==null?void 0:e.id)??null}),O=r(()=>{var o,e;return v.props.currentUserRole??((e=(o=v.props.auth)==null?void 0:o.user)==null?void 0:e.role)??null}),P=i(X.value.periodo??"2025-2"),B=i(!1),b=i(null),k=i(""),R=i(""),S=i(""),M=i(""),x=i(""),w=i(""),$=i(""),c=i(""),j=i(""),T=r(()=>{const o=new Set(N.value.map(e=>String(e.user_id)));return Q.value.filter(e=>!o.has(String(e.id)))}),Y=r(()=>V.value.find(o=>String(o.id)===String(x.value))??null),I=o=>{var f,y;if(!o)return[];const e=[];(f=o.modalidad_rel)!=null&&f.nombre&&e.push(String(o.modalidad_rel.nombre)),(y=o.modalidadRel)!=null&&y.nombre&&e.push(String(o.modalidadRel.nombre)),o.modalidad&&e.push(String(o.modalidad)),Array.isArray(o.modalidades)&&e.push(...o.modalidades.map(d=>String((d==null?void 0:d.nombre)??d)));const t=e.flatMap(d=>d.split(/[;,/|]+/)).map(d=>d.trim()).filter(d=>d.length>0);return Array.from(new Set(t))},z=r(()=>I(Y.value)),W=r(()=>I(b.value));re(x,()=>{(!c.value||!z.value.includes(c.value))&&(c.value=z.value[0]??"")},{immediate:!0});function Z(o){var f,y,d,h;b.value=o,k.value=String(((f=o.assignment)==null?void 0:f.responsable_user_id)??((y=o.responsable)==null?void 0:y.id)??""),R.value=String(((d=o.assignment)==null?void 0:d.sede_id)??"");const e=I(o),t=String(((h=o.assignment)==null?void 0:h.modalidad_docente)??"");S.value=t&&e.includes(t)?t:e[0]??t,M.value="",B.value=!0}function E(){B.value=!1,b.value=null}function ee(){!b.value||!k.value||C.patch(`/responsabilidades/${b.value.id}`,{responsable_user_id:k.value,sede_id:R.value||void 0,modalidad_docente:S.value||void 0,reason:M.value||void 0},{preserveScroll:!0,onSuccess:()=>{E()}})}function te(){!x.value||!w.value||C.patch(`/responsabilidades/${x.value}`,{responsable_user_id:w.value,sede_id:$.value||void 0,modalidad_docente:c.value||void 0,reason:j.value||void 0},{preserveScroll:!0,onSuccess:()=>{x.value="",w.value="",$.value="",c.value="",j.value=""}})}function se(o){o.assignment&&C.post(`/responsabilidades/${o.assignment.id}/aceptar`,{},{preserveScroll:!0})}function oe(o){o.assignment&&C.post(`/responsabilidades/${o.assignment.id}/rechazar`,{},{preserveScroll:!0})}const ne=o=>{if(!o.assignment)return"Pendiente";const e=o.assignment.status??"aceptado";return e==="invitado"?"Pendiente de aceptaciÃ³n":e==="rechazado"?"Rechazado":"Aceptado"},le=o=>{if(!o.assignment)return"bg-gray-300 text-gray-800";const e=o.assignment.status??"aceptado";return e==="invitado"?"bg-amber-500 text-white":e==="rechazado"?"bg-red-500 text-white":"bg-emerald-600 text-white"};return(o,e)=>(n(),ie(ce,{breadcrumbs:K},{default:ue(()=>[pe(J(me),{title:"Responsabilidades de cursos"}),s("div",ge,[s("div",be,[e[14]||(e[14]=s("h1",{class:"text-2xl font-semibold"},"Responsables de cursos",-1)),s("div",xe,[s("label",fe,[e[13]||(e[13]=s("span",{class:"text-muted-foreground"},"Periodo:",-1)),u(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>P.value=t),class:"border rounded px-2 py-1 text-sm bg-background text-foreground",onChange:e[1]||(e[1]=t=>J(C).get("/responsabilidades",{periodo:P.value},{preserveScroll:!0}))},[A.value.length?g("",!0):(n(),l("option",ye,"2025-2")),A.value.length?g("",!0):(n(),l("option",_e,"2026-0")),A.value.length?g("",!0):(n(),l("option",ke,"2026-1")),(n(!0),l(p,null,m(A.value,t=>(n(),l("option",{key:t.id,value:t.codigo},a(t.codigo),9,Se))),128))],544),[[_,P.value]])])])]),O.value==="admin"?(n(),l("div",we,[e[24]||(e[24]=s("h2",{class:"text-base font-semibold mb-2"},"Asignar responsable a un curso",-1)),e[25]||(e[25]=s("p",{class:"text-xs text-muted-foreground mb-4"}," Selecciona el curso, el docente responsable y la modalidad docente para registrar la asignacion. ",-1)),s("div",he,[s("label",Ce,[e[16]||(e[16]=s("span",{class:"text-muted-foreground"},"Curso",-1)),u(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>x.value=t),class:"mt-1 w-full border rounded px-2 py-1 text-sm bg-background text-foreground"},[e[15]||(e[15]=s("option",{value:""},"Seleccione curso",-1)),(n(!0),l(p,null,m(V.value,t=>(n(),l("option",{key:t.id,value:t.id},a(t.codigo)+" - "+a(t.nombre),9,Ve))),128))],512),[[_,x.value]])]),s("label",Ae,[e[18]||(e[18]=s("span",{class:"text-muted-foreground"},"Docente responsable",-1)),u(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>w.value=t),class:"mt-1 w-full border rounded px-2 py-1 text-sm bg-background text-foreground"},[e[17]||(e[17]=s("option",{value:""},"Seleccione docente",-1)),(n(!0),l(p,null,m(N.value,t=>(n(),l("option",{key:t.id,value:t.user_id},a(t.nombre)+" "+a(t.apellido),9,Ue))),128))],512),[[_,w.value]])]),s("label",Re,[e[20]||(e[20]=s("span",{class:"text-muted-foreground"},"Modalidad docente",-1)),z.value.length?u((n(),l("select",{key:0,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value=t),class:"mt-1 w-full border rounded px-2 py-1 text-sm bg-background text-foreground"},[e[19]||(e[19]=s("option",{value:""},"Seleccione modalidad",-1)),(n(!0),l(p,null,m(z.value,t=>(n(),l("option",{key:t,value:t},a(t),9,Me))),128))],512)),[[_,c.value]]):u((n(),l("input",{key:1,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value=t),class:"mt-1 w-full border rounded px-2 py-1 text-sm bg-background text-foreground",placeholder:"Presencial, Virtual, etc."},null,512)),[[D,c.value]])]),s("label",$e,[e[22]||(e[22]=s("span",{class:"text-muted-foreground"},"Sede (opcional)",-1)),u(s("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>$.value=t),class:"mt-1 w-full border rounded px-2 py-1 text-sm bg-background text-foreground"},[e[21]||(e[21]=s("option",{value:""},"Seleccione sede",-1)),(n(!0),l(p,null,m(L.value,t=>(n(),l("option",{key:t.id,value:t.id},a(t.nombre),9,je))),128))],512),[[_,$.value]])]),s("label",ze,[e[23]||(e[23]=s("span",{class:"text-muted-foreground"},"Motivo / comentario (opcional)",-1)),u(s("textarea",{"onUpdate:modelValue":e[7]||(e[7]=t=>j.value=t),rows:"2",class:"mt-1 w-full border rounded px-2 py-1 text-sm bg-background text-foreground"},null,512),[[D,j.value]])])]),s("div",De,[s("button",{type:"button",class:"px-3 py-1 text-sm rounded bg-primary text-primary-foreground hover:opacity-90",disabled:!x.value||!w.value,onClick:te}," Asignar ",8,Ne)])])):g("",!0),V.value.length===0?(n(),l("div",Pe," No hay cursos para el periodo seleccionado. ")):(n(),l("div",Be,[(n(!0),l(p,null,m(V.value,t=>{var f,y,d,h,q,G;return n(),l("div",{key:t.id,class:"border rounded-lg bg-card p-4 flex flex-col justify-between"},[s("div",Ie,[s("div",Ee,a(t.codigo)+" - "+a(t.nombre),1),s("div",Fe,[e[26]||(e[26]=F(" Modalidad: ")),s("span",Le,a(((f=t.modalidad_rel)==null?void 0:f.nombre)??((y=t.modalidadRel)==null?void 0:y.nombre)??"-"),1)]),s("div",Oe,[e[27]||(e[27]=F(" Docente principal: ")),s("span",Te,a(((d=t.docente)==null?void 0:d.nombre)??"Sin asignar"),1)]),s("div",We,[e[28]||(e[28]=F(" Responsable actual: ")),s("span",qe,a(((q=(h=t.assignment)==null?void 0:h.responsable)==null?void 0:q.name)??((G=t.responsable)==null?void 0:G.name)??"Sin asignar"),1)])]),s("div",Ge,[s("span",{class:ve(["px-3 py-1 rounded-full text-xs font-semibold",le(t)])},a(ne(t)),3),s("div",He,[t.assignment&&t.assignment.status==="invitado"&&U.value&&t.assignment.responsable_user_id===U.value?(n(),l("button",{key:0,type:"button",class:"px-3 py-1 text-xs rounded border bg-emerald-600 text-white hover:bg-emerald-700",onClick:H=>se(t)}," Aceptar ",8,Je)):g("",!0),t.assignment&&t.assignment.status==="invitado"&&U.value&&t.assignment.responsable_user_id===U.value?(n(),l("button",{key:1,type:"button",class:"px-3 py-1 text-xs rounded border bg-red-600 text-white hover:bg-red-700",onClick:H=>oe(t)}," Rechazar ",8,Ke)):g("",!0),O.value==="admin"?(n(),l("button",{key:2,type:"button",class:"px-3 py-1 text-xs rounded border bg-primary text-primary-foreground hover:opacity-90",onClick:H=>Z(t)}," Editar ",8,Qe)):g("",!0)])])])}),128))])),B.value&&b.value?(n(),l("div",Xe,[s("div",Ye,[s("div",Ze,[s("div",null,[e[29]||(e[29]=s("h2",{class:"text-lg font-semibold"},"Editar responsable",-1)),s("p",et,a(b.value.codigo)+" - "+a(b.value.nombre),1)]),s("button",{type:"button",class:"text-muted-foreground hover:text-foreground",onClick:E}," x ")]),s("div",tt,[s("label",st,[e[31]||(e[31]=s("span",{class:"text-muted-foreground"},"Docente responsable",-1)),u(s("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>k.value=t),class:"mt-1 w-full border rounded px-2 py-1 text-sm bg-background text-foreground"},[e[30]||(e[30]=s("option",{value:""},"Seleccione docente",-1)),s("optgroup",ot,[(n(!0),l(p,null,m(N.value,t=>(n(),l("option",{key:t.id,value:t.user_id},a(t.nombre)+" "+a(t.apellido),9,nt))),128))]),T.value.length?(n(),l("optgroup",lt,[(n(!0),l(p,null,m(T.value,t=>(n(),l("option",{key:t.id,value:t.id},a(t.name),9,at))),128))])):g("",!0)],512),[[_,k.value]])]),s("label",dt,[e[33]||(e[33]=s("span",{class:"text-muted-foreground"},"Sede",-1)),u(s("select",{"onUpdate:modelValue":e[9]||(e[9]=t=>R.value=t),class:"mt-1 w-full border rounded px-2 py-1 text-sm bg-background text-foreground"},[e[32]||(e[32]=s("option",{value:""},"Seleccione sede",-1)),(n(!0),l(p,null,m(L.value,t=>(n(),l("option",{key:t.id,value:t.id},a(t.nombre),9,rt))),128))],512),[[_,R.value]])]),s("label",it,[e[35]||(e[35]=s("span",{class:"text-muted-foreground"},"Modalidad docente",-1)),W.value.length?u((n(),l("select",{key:0,"onUpdate:modelValue":e[10]||(e[10]=t=>S.value=t),class:"mt-1 w-full border rounded px-2 py-1 text-sm bg-background text-foreground"},[e[34]||(e[34]=s("option",{value:""},"Seleccione modalidad",-1)),(n(!0),l(p,null,m(W.value,t=>(n(),l("option",{key:t,value:t},a(t),9,ut))),128))],512)),[[_,S.value]]):u((n(),l("input",{key:1,"onUpdate:modelValue":e[11]||(e[11]=t=>S.value=t),class:"mt-1 w-full border rounded px-2 py-1 text-sm bg-background text-foreground",placeholder:"Presencial, Virtual, etc."},null,512)),[[D,S.value]])]),s("label",pt,[e[36]||(e[36]=s("span",{class:"text-muted-foreground"},"Motivo / comentario",-1)),u(s("textarea",{"onUpdate:modelValue":e[12]||(e[12]=t=>M.value=t),rows:"3",class:"mt-1 w-full border rounded px-2 py-1 text-sm bg-background text-foreground"},null,512),[[D,M.value]])])]),s("div",mt,[s("button",{type:"button",class:"px-3 py-1 text-sm rounded border",onClick:E}," Cancelar "),s("button",{type:"button",class:"px-3 py-1 text-sm rounded bg-primary text-primary-foreground hover:opacity-90",disabled:!k.value,onClick:ee}," Guardar ",8,vt)])])])):g("",!0)])]),_:1}))}});export{yt as default};

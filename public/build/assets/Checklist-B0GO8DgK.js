import{d as Y,n as Z,c as m,r as w,q as ee,W as V,a as y,o as r,w as o,m as d,b as s,u as l,s as te,g as F,e as i,F as _,i as x,t as u,v as A,f as h,k as p,j as W}from"./app-0xfeTETD.js";import{_ as se}from"./AppLayout.vue_vue_type_script_setup_true_lang-Czkn1H1y.js";import{_ as ae,a as oe,b as N,c as v,d as le,e as f}from"./TableHeader.vue_vue_type_script_setup_true_lang-DP-hyYMr.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BRkfCIi1.js";import"./index-1Zo7FGYr.js";const re={class:"p-6"},ne={class:"mb-4 flex flex-wrap gap-3 items-center"},de={class:"text-sm flex items-center gap-2"},ie=["value"],ue={class:"text-sm flex items-center gap-2"},pe={key:0,value:"",disabled:""},me=["value"],ce={class:"text-sm flex items-center gap-2"},fe=["value"],ve={key:0},ge={key:1,class:"text-muted-foreground"},be=["value","onChange"],_e={class:"flex flex-col gap-2"},xe={class:"text-xs"},ke={class:"font-medium"},ye={key:0,class:"flex flex-wrap gap-2"},Ce=["onClick"],Se=["disabled","onClick"],he=["href"],$e={key:2,class:"text-xs text-muted-foreground"},Ee=Y({__name:"Checklist",setup(we){var M,U,j;const c=Z(),q=[{title:"Dashboard",href:"/dashboard"},{title:"Checklist",href:"/cursos/checklist"}],D=m(()=>c.props.cursos??[]),E=m(()=>{var a,e;return((e=(a=c.props.auth)==null?void 0:a.user)==null?void 0:e.role)??null}),z=m(()=>c.props.sedes??[]),G=m(()=>c.props.sedesCatalog??[]),I=m(()=>c.props.areasCatalog??[]),B=m(()=>c.props.modalidadesCatalog??[]),L=m(()=>c.props.tiposEvidencia??[]),k=m(()=>{const a=["acta","guia","presentacion","trabajo","registro","informe_final"];return[...L.value].sort((e,t)=>{const n=a.indexOf(e.codigo),b=a.indexOf(t.codigo);return n!==-1||b!==-1?(n===-1?999:n)-(b===-1?999:b):String(e.nombre).localeCompare(String(t.nombre))})}),H=m(()=>{const a=G.value.map(n=>n.nombre),e=z.value,t=[...a,...e].filter(n=>n&&n.trim()!=="");return Array.from(new Set(t))}),C=w(((M=c.props.filters)==null?void 0:M.sede)??""),g=w(String(((U=c.props.filters)==null?void 0:U.area_id)??"")),S=w(String(((j=c.props.filters)==null?void 0:j.modalidad_id)??"")),O=m(()=>g.value?B.value.filter(a=>String(a.area_id??"")===String(g.value)):B.value);ee([C,g,S],()=>{V.get("/cursos/checklist",{sede:C.value||void 0,area_id:g.value||void 0,modalidad_id:S.value||void 0},{preserveScroll:!0,preserveState:!0})});const J=a=>a==="cumplido"?"Cumplido":a==="pendiente"?"Pendiente":"N/A",R=m(()=>E.value==="admin"||E.value==="responsable"),K=(a,e)=>(a.checklist_manual??{})[e]??"auto",Q=(a,e,t)=>{V.patch(`/cursos/${a}/checklist-item`,{item:e,estado:t},{preserveScroll:!0})},$=a=>!a||!k.value.length?!1:k.value.every(e=>a[e.codigo]==="cumplido"),T=(a,e)=>{V.patch(`/cursos/${a}/review-state`,{action:e},{preserveScroll:!0})};return(a,e)=>(r(),y(se,{breadcrumbs:q},{default:o(()=>[d(l(te),{title:"Checklist de Cursos"}),s("div",re,[e[18]||(e[18]=s("h1",{class:"mb-2 text-2xl font-semibold"},"Checklist de cursos",-1)),e[19]||(e[19]=s("p",{class:"mb-4 text-sm text-muted-foreground"}," El estado de cada curso se calcula en base a evidencias validadas por el responsable o admin, además de actas y documentos finales registrados en el sistema. ",-1)),s("div",ne,[s("label",de,[e[4]||(e[4]=s("span",{class:"text-muted-foreground"},"Area:",-1)),F(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),class:"border border-border bg-background text-foreground text-sm rounded px-2 py-1"},[e[3]||(e[3]=s("option",{value:""},"Todas",-1)),(r(!0),i(_,null,x(I.value,t=>(r(),i("option",{key:t.id,value:t.id},u(t.nombre),9,ie))),128))],512),[[A,g.value]])]),s("label",ue,[e[6]||(e[6]=s("span",{class:"text-muted-foreground"},"Modalidad:",-1)),F(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>S.value=t),class:"border border-border bg-background text-foreground text-sm rounded px-2 py-1"},[e[5]||(e[5]=s("option",{value:""},"Todas",-1)),O.value.length?h("",!0):(r(),i("option",pe,"Sin modalidades")),(r(!0),i(_,null,x(O.value,t=>(r(),i("option",{key:t.id,value:t.id},u(t.nombre),9,me))),128))],512),[[A,S.value]])]),s("label",ce,[e[8]||(e[8]=s("span",{class:"text-muted-foreground"},"Sede:",-1)),F(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t),class:"border border-border bg-background text-foreground text-sm rounded px-2 py-1"},[e[7]||(e[7]=s("option",{value:""},"Todas",-1)),(r(!0),i(_,null,x(H.value,t=>(r(),i("option",{key:t,value:t},u(t),9,fe))),128))],512),[[A,C.value]])])]),d(l(ae),null,{default:o(()=>[d(l(oe),null,{default:o(()=>[d(l(N),null,{default:o(()=>[d(l(v),null,{default:o(()=>e[9]||(e[9]=[p("Curso")])),_:1}),d(l(v),null,{default:o(()=>e[10]||(e[10]=[p("Docente")])),_:1}),d(l(v),null,{default:o(()=>e[11]||(e[11]=[p("Responsable")])),_:1}),d(l(v),null,{default:o(()=>e[12]||(e[12]=[p("Sede")])),_:1}),(r(!0),i(_,null,x(k.value,t=>(r(),y(l(v),{key:t.codigo},{default:o(()=>[p(u(t.nombre),1)]),_:2},1024))),128)),d(l(v),null,{default:o(()=>e[13]||(e[13]=[p("Avance")])),_:1}),d(l(v),null,{default:o(()=>e[14]||(e[14]=[p("Acciones")])),_:1})]),_:1})]),_:1}),d(l(le),null,{default:o(()=>[D.value.length===0?(r(),y(l(N),{key:0},{default:o(()=>[d(l(f),{colspan:6+k.value.length,class:"text-center text-muted-foreground"},{default:o(()=>e[15]||(e[15]=[p(" No hay cursos asignados por el momento. ")])),_:1},8,["colspan"])]),_:1})):h("",!0),(r(!0),i(_,null,x(D.value,t=>(r(),y(l(N),{key:t.id},{default:o(()=>[d(l(f),{class:"font-medium"},{default:o(()=>[p(u(t.nombre),1)]),_:2},1024),d(l(f),null,{default:o(()=>[t.docente?(r(),i("span",ve,u(t.docente.nombre)+" "+u(t.docente.apellido),1)):(r(),i("span",ge,"Sin docente asignado"))]),_:2},1024),d(l(f),null,{default:o(()=>{var n;return[p(u(((n=t.responsable)==null?void 0:n.name)??"Sin asignar"),1)]}),_:2},1024),d(l(f),null,{default:o(()=>[p(u(t.sede_label??"General"),1)]),_:2},1024),(r(!0),i(_,null,x(k.value,n=>(r(),y(l(f),{key:`${t.id}-${n.codigo}`},{default:o(()=>{var b,P;return[s("span",{class:W(((b=t.checklist_status)==null?void 0:b[n.codigo])==="cumplido"?"text-emerald-600":"text-amber-600")},u(J((P=t.checklist_status)==null?void 0:P[n.codigo])),3),R.value?(r(),i("select",{key:0,class:"ml-2 border border-border bg-background text-foreground text-xs rounded px-1 py-0.5",value:K(t,n.codigo),onChange:X=>Q(t.id,n.codigo,X.target.value)},e[16]||(e[16]=[s("option",{value:"auto"},"Auto",-1),s("option",{value:"cumplido"},"Cumplido",-1),s("option",{value:"pendiente"},"Pendiente",-1)]),40,be)):h("",!0)]}),_:2},1024))),128)),d(l(f),null,{default:o(()=>[s("span",null,u(t.avance??0)+"%",1)]),_:2},1024),d(l(f),null,{default:o(()=>[s("div",_e,[s("div",xe,[e[17]||(e[17]=p(" Estado revisión: ")),s("span",ke,u(t.review_state??"pendiente"),1)]),R.value?(r(),i("div",ye,[s("button",{type:"button",class:"px-2 py-1 text-xs rounded border border-amber-500 text-amber-700 hover:bg-amber-50",onClick:n=>T(t.id,"observado")}," Observar ",8,Ce),s("button",{type:"button",class:W(["px-2 py-1 text-xs rounded border",$(t.checklist_status)&&t.review_state!=="validado"?"border-emerald-600 text-emerald-700 hover:bg-emerald-50":"border-muted text-muted-foreground cursor-not-allowed"]),disabled:!$(t.checklist_status)||t.review_state==="validado",onClick:n=>$(t.checklist_status)&&T(t.id,"validado")}," Validar ",10,Se)])):h("",!0),t.drive_url?(r(),i("a",{key:1,href:t.drive_url,target:"_blank",rel:"noopener noreferrer",class:"text-primary hover:underline text-xs"}," Revisar curso ",8,he)):(r(),i("span",$e,"Sin Drive asignado"))])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1}))}});export{Ee as default};

import{d as I,n as $,r as S,c as u,q as O,W as f,a as G,o as d,w as z,m as M,b as e,u as W,s as q,g as i,e as r,f as g,F as p,i as c,t as n,v as _,h as C,k as R,j as L}from"./app-0xfeTETD.js";import{_ as X}from"./AppLayout.vue_vue_type_script_setup_true_lang-Czkn1H1y.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BRkfCIi1.js";import"./index-1Zo7FGYr.js";const H={class:"p-6 space-y-6"},J={class:"flex flex-wrap items-center justify-between gap-3"},K={class:"flex flex-wrap items-center gap-3"},Q={class:"text-sm flex items-center gap-2"},Y={key:0,value:"2025-2"},Z={key:1,value:"2026-0"},ee={key:2,value:"2026-1"},te=["value"],se={class:"text-sm flex items-center gap-2"},oe=["value"],de={class:"rounded-lg border bg-card"},re={class:"w-full text-sm"},ae={key:0},ne={class:"px-4 py-2 font-medium"},le={class:"px-4 py-2 text-right"},ue={class:"px-4 py-2 text-right"},ie={class:"px-4 py-2 text-right"},pe={class:"px-4 py-2 text-right"},ce={class:"px-4 py-2 text-right"},ve={class:"rounded-lg border bg-card p-4 space-y-3"},xe={class:"grid gap-2 md:grid-cols-4"},me=["value"],ge=["value"],_e=["disabled"],be=["value"],fe={class:"space-y-3"},ye={key:0,class:"text-sm text-muted-foreground"},he={class:"grid gap-3 md:grid-cols-2 lg:grid-cols-3"},ke={class:"space-y-1"},we={class:"text-xs text-muted-foreground flex justify-between"},Se={class:"font-medium text-foreground"},Ce={class:"text-sm font-medium line-clamp-3"},Re={class:"text-xs text-muted-foreground"},Ve={class:"font-medium text-foreground"},je={class:"text-xs text-muted-foreground"},Ae={class:"font-medium text-foreground"},Ee={class:"mt-3 flex items-center justify-between text-xs"},Oe={class:"flex gap-1"},Ne={class:"flex gap-1"},Ue=["value","onChange"],De=["value"],Be=["onClick"],Ge=I({__name:"Index",setup(Pe){const l=$(),N=[{title:"Dashboard",href:"/dashboard"},{title:"Final",href:"/final"}],y=S(l.props.periodo??"2025-2"),h=S(l.props.sede??""),U=u(()=>l.props.sedes??[]),D=u(()=>l.props.sedesCatalog??[]),b=u(()=>l.props.periodosCatalog??[]),k=u(()=>{const a=D.value.map(t=>t.nombre),s=U.value,v=[...a,...s].filter(t=>t&&t.trim()!=="");return Array.from(new Set(v))}),V=u(()=>l.props.summary??{}),j=u(()=>l.props.opportunities??[]),A=u(()=>l.props.courses??[]);O([y,h],([a,s])=>{f.get("/final",{periodo:a,sede:s||void 0},{preserveScroll:!0,preserveState:!0})});const o=S({curso_id:"",sede:"",descripcion:"",owner_user_id:"",due_date:""}),B=["ABIERTA","EN_PROGRESO","CERRADA"],w=u(()=>A.value.find(a=>String(a.id)===String(o.value.curso_id)));O(()=>o.value.curso_id,()=>{const a=w.value;if(!a){o.value.owner_user_id="";return}!o.value.sede&&a.sede&&(o.value.sede=a.sede);const s=a.responsables??[];s.length===1?o.value.owner_user_id=String(s[0].id):s.length>1&&s.some(v=>String(v.id)===String(o.value.owner_user_id))||(o.value.owner_user_id="")});const P=()=>{!o.value.curso_id||!o.value.descripcion||f.post("/final/opportunities",{...o.value,owner_user_id:o.value.owner_user_id||void 0,due_date:o.value.due_date||void 0},{onSuccess:()=>{o.value={curso_id:"",sede:"",descripcion:"",owner_user_id:"",due_date:""}}})},T=(a,s)=>{f.put(`/final/opportunities/${a.id}`,{descripcion:s.descripcion??a.descripcion,owner_user_id:s.owner_user_id??a.owner_user_id??void 0,due_date:s.due_date??a.due_date??void 0,status:s.status??a.status},{preserveScroll:!0})},F=a=>{confirm("¿Eliminar esta oportunidad de mejora?")&&f.delete(`/final/opportunities/${a.id}`,{preserveScroll:!0})};return(a,s)=>(d(),G(X,{breadcrumbs:N},{default:z(()=>{var v;return[M(W(q),{title:"Resultados finales por sede"}),e("div",H,[e("div",J,[s[11]||(s[11]=e("div",null,[e("h1",{class:"text-2xl font-semibold"},"Resultados finales por sede"),e("p",{class:"text-sm text-muted-foreground"}," Resumen de aprobación y oportunidades de mejora agregadas por sede y asignatura. ")],-1)),e("div",K,[e("label",Q,[s[8]||(s[8]=e("span",{class:"text-muted-foreground"},"Periodo:",-1)),i(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>y.value=t),class:"border rounded px-2 py-1 text-sm bg-background text-foreground"},[b.value.length?g("",!0):(d(),r("option",Y,"2025-2")),b.value.length?g("",!0):(d(),r("option",Z,"2026-0")),b.value.length?g("",!0):(d(),r("option",ee,"2026-1")),(d(!0),r(p,null,c(b.value,t=>(d(),r("option",{key:t.id,value:t.codigo},n(t.codigo),9,te))),128))],512),[[_,y.value]])]),e("label",se,[s[10]||(s[10]=e("span",{class:"text-muted-foreground"},"Sede:",-1)),i(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>h.value=t),class:"border rounded px-2 py-1 text-sm bg-background text-foreground"},[s[9]||(s[9]=e("option",{value:""},"Todas",-1)),(d(!0),r(p,null,c(k.value,t=>(d(),r("option",{key:t,value:t},n(t),9,oe))),128))],512),[[_,h.value]])])])]),e("div",de,[s[14]||(s[14]=e("div",{class:"px-4 py-2 border-b text-sm font-medium"},"Indicadores por sede",-1)),e("table",re,[s[13]||(s[13]=e("thead",{class:"bg-muted"},[e("tr",null,[e("th",{class:"text-left px-4 py-2"},"Sede"),e("th",{class:"text-right px-4 py-2"},"Aprobados"),e("th",{class:"text-right px-4 py-2"},"Desaprobados"),e("th",{class:"text-right px-4 py-2"},"% Aprobados"),e("th",{class:"text-right px-4 py-2"},"Promedio EP"),e("th",{class:"text-right px-4 py-2"},"Avance promedio (%)")])],-1)),e("tbody",null,[Object.keys(V.value).length===0?(d(),r("tr",ae,s[12]||(s[12]=[e("td",{colspan:"6",class:"px-4 py-3 text-center text-muted-foreground"}," No hay datos consolidados para el periodo/sede seleccionados. ",-1)]))):g("",!0),(d(!0),r(p,null,c(V.value,(t,m)=>(d(),r("tr",{key:m,class:"border-t"},[e("td",ne,n(m),1),e("td",le,n(t.aprobados),1),e("td",ue,n(t.desaprobados),1),e("td",ie,n(t.porcentaje_aprobados)+"%",1),e("td",pe,n(t.promedio),1),e("td",ce,n(t.avance_promedio)+"%",1)]))),128))])])]),e("div",ve,[s[18]||(s[18]=e("h2",{class:"text-sm font-semibold"},"Nueva oportunidad de mejora",-1)),e("div",xe,[i(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>o.value.curso_id=t),class:"border rounded px-2 py-1 text-sm bg-background text-foreground"},[s[15]||(s[15]=e("option",{value:""},"Seleccione curso",-1)),(d(!0),r(p,null,c(A.value,t=>(d(),r("option",{key:t.id,value:t.id},n(t.codigo)+" - "+n(t.nombre),9,me))),128))],512),[[_,o.value.curso_id]]),k.value.length?i((d(),r("select",{key:0,"onUpdate:modelValue":s[3]||(s[3]=t=>o.value.sede=t),class:"border rounded px-2 py-1 text-sm bg-background text-foreground"},[s[16]||(s[16]=e("option",{value:""},"Seleccione sede",-1)),(d(!0),r(p,null,c(k.value,t=>(d(),r("option",{key:t,value:t},n(t),9,ge))),128))],512)),[[_,o.value.sede]]):i((d(),r("input",{key:1,"onUpdate:modelValue":s[4]||(s[4]=t=>o.value.sede=t),class:"border rounded px-2 py-1 text-sm bg-background text-foreground",placeholder:"Sede"},null,512)),[[C,o.value.sede]]),i(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>o.value.owner_user_id=t),class:"border rounded px-2 py-1 text-sm bg-background text-foreground",disabled:!w.value},[s[17]||(s[17]=e("option",{value:""},"Responsable (auto)",-1)),(d(!0),r(p,null,c(((v=w.value)==null?void 0:v.responsables)??[],t=>(d(),r("option",{key:t.id,value:t.id},n(t.name),9,be))),128))],8,_e),[[_,o.value.owner_user_id]]),i(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>o.value.due_date=t),type:"date",class:"border rounded px-2 py-1 text-sm bg-background text-foreground"},null,512),[[C,o.value.due_date]])]),i(e("textarea",{"onUpdate:modelValue":s[7]||(s[7]=t=>o.value.descripcion=t),class:"w-full border rounded px-2 py-1 text-sm bg-background text-foreground",rows:"3",placeholder:"Describe la oportunidad de mejora..."},null,512),[[C,o.value.descripcion]]),e("div",{class:"flex justify-end"},[e("button",{type:"button",class:"px-3 py-1 rounded bg-primary text-primary-foreground text-sm hover:opacity-90",onClick:P}," Guardar oportunidad ")])]),e("div",fe,[s[22]||(s[22]=e("h2",{class:"text-sm font-semibold"},"Oportunidades registradas",-1)),j.value.length===0?(d(),r("div",ye," No hay oportunidades registradas para el filtro actual. ")):g("",!0),e("div",he,[(d(!0),r(p,null,c(j.value,t=>{var m,E;return d(),r("div",{key:t.id,class:"border rounded-lg bg-card p-3 flex flex-col justify-between"},[e("div",ke,[e("div",we,[e("span",null,[s[19]||(s[19]=R("Sede: ")),e("span",Se,n(t.sede),1)]),e("span",null,"Curso: "+n(((m=t.curso)==null?void 0:m.codigo)??t.curso_id),1)]),e("div",Ce,n(t.descripcion),1),e("div",Re,[s[20]||(s[20]=R(" Responsable: ")),e("span",Ve,n(((E=t.owner)==null?void 0:E.name)??"No asignado"),1)]),e("div",je,[s[21]||(s[21]=R(" Vence: ")),e("span",Ae,n(t.due_date??"Sin fecha"),1)])]),e("div",Ee,[e("div",Oe,[e("span",{class:L(["px-2 py-0.5 rounded-full border",{"border-emerald-500 text-emerald-700":t.status==="CERRADA","border-amber-500 text-amber-700":t.status==="EN_PROGRESO","border-slate-400 text-slate-700":t.status==="ABIERTA"}])},n(t.status),3)]),e("div",Ne,[e("select",{class:"border rounded px-1 py-0.5 text-xs bg-background text-foreground",value:t.status,onChange:x=>T(t,{status:x.target.value})},[(d(),r(p,null,c(B,x=>e("option",{key:x,value:x},n(x),9,De)),64))],40,Ue),e("button",{type:"button",class:"px-2 py-0.5 rounded border border-destructive text-destructive hover:bg-destructive/10",onClick:x=>F(t)}," X ",8,Be)])])])}),128))])])])]}),_:1}))}});export{Ge as default};

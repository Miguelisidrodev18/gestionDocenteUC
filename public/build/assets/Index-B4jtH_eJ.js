import{d as re,n as le,r as M,c as f,q as ae,x as ne,a as ie,o as t,w as ue,b as e,e as d,u,F as c,i as p,t as r,y as Z,f as H,k as S,g,v as w,h as ce,W as O}from"./app-0xfeTETD.js";import{_ as pe}from"./AppLayout.vue_vue_type_script_setup_true_lang-Czkn1H1y.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BRkfCIi1.js";import"./index-1Zo7FGYr.js";const xe={class:"p-8 min-h-screen text-foreground bg-gradient-to-b from-[#FBE4D8] via-[#854F6C] to-[#190019]"},me={key:0},be={key:0,class:"text-sm text-muted-foreground"},fe={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},ge={class:"font-semibold mb-1"},ve={class:"text-xs text-muted-foreground mb-2"},_e={class:"text-xs mb-1"},he={class:"h-2 bg-muted rounded mb-3"},ye={class:"text-xs mb-2 space-x-2"},we={class:"flex gap-2 justify-end"},ke=["onClick"],Ce={key:1,class:"space-y-8"},Pe={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"},Me={class:"bg-card/90 backdrop-blur p-6 rounded-2xl shadow-lg shadow-[#190019]/30 border border-white/10"},Se={class:"text-3xl font-bold text-green-300"},Fe={class:"bg-card/90 backdrop-blur p-6 rounded-2xl shadow-lg shadow-[#190019]/30 border border-white/10"},Te={class:"text-3xl font-bold text-purple-300"},Ae={class:"bg-card/90 backdrop-blur p-6 rounded-2xl shadow-lg shadow-[#190019]/30 border border-white/10 flex flex-col justify-between"},Be={class:"text-xs text-muted-foreground mb-4"},Ne={class:"text-foreground font-medium"},je={class:"text-3xl font-bold text-green-300"},De={class:"mt-4 text-[11px] text-muted-foreground"},Ve={class:"text-foreground"},$e={class:"bg-card/90 backdrop-blur p-4 rounded-2xl border border-white/10 flex flex-wrap items-end gap-4 shadow-md shadow-[#190019]/30"},Ue={class:"flex flex-col"},Ee=["value"],Re={class:"flex flex-col"},ze=["value"],Ge={class:"flex flex-col"},qe={key:0,value:"",disabled:""},Ie=["value"],Le={class:"flex flex-col"},We=["value"],Xe=["disabled"],Ze={key:0,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},He={class:"space-y-4"},Oe={class:"bg-card/90 backdrop-blur p-4 rounded-2xl border border-white/10 shadow-md shadow-[#190019]/30 flex flex-col items-center justify-center gap-4"},Je={class:"w-40 h-40 relative"},Ke={viewBox:"0 0 160 160",class:"w-full h-full"},Qe=["stroke-dashoffset"],Ye={class:"absolute inset-0 flex flex-col items-center justify-center"},es={class:"text-3xl font-bold"},ss={class:"text-[11px] text-muted-foreground"},os={class:"flex gap-6 text-xs mt-2"},ts={class:"flex flex-col items-center"},ds={class:"px-3 py-1 rounded-full bg-secondary/40 text-sm font-semibold"},rs={class:"flex flex-col items-center"},ls={class:"px-3 py-1 rounded-full bg-destructive/20 text-sm font-semibold text-red-300"},as={class:"bg-card/90 backdrop-blur p-4 rounded-2xl border border-white/10 shadow-md shadow-[#190019]/30"},ns={key:0,class:"text-xs text-muted-foreground"},is={key:1,class:"space-y-2 text-xs max-h-64 overflow-auto"},us={class:"mr-2 truncate"},cs={class:"font-medium truncate"},ps={class:"text-[11px] text-muted-foreground truncate"},xs={class:"text-right"},ms={class:"font-semibold text-red-400"},bs={class:"bg-card/90 backdrop-blur p-4 rounded-2xl border border-white/10 shadow-md shadow-[#190019]/30 lg:col-span-1"},fs={key:0,class:"text-xs text-muted-foreground"},gs={key:1,class:"space-y-2 max-h-80 overflow-auto"},vs={class:"flex justify-between"},_s={class:"truncate mr-2"},hs={class:"text-muted-foreground"},ys={class:"h-2 bg-muted rounded"},ws={class:"text-[11px] text-muted-foreground"},ks={class:"bg-card/90 backdrop-blur p-4 rounded-2xl border border-white/10 shadow-md shadow-[#190019]/30 lg:col-span-1"},Cs={key:0,class:"text-xs text-muted-foreground"},Ps={key:1,class:"space-y-3 text-xs"},Ms={class:"w-full h-40 relative"},Ss={viewBox:"0 0 100 100",class:"w-full h-full"},Fs=["points"],Ts={class:"flex flex-wrap gap-2 text-[11px] text-muted-foreground"},As={class:"text-foreground"},F=60,Us=re({__name:"Index",setup(Bs){var U,E,R,z,G,q;const{props:i}=le(),k=i.currentUserRole??((E=(U=i.auth)==null?void 0:U.user)==null?void 0:E.role),J=[{title:"Dashboard",href:"/dashboard"}],K=i.docentesCount??0,Q=i.cursosCount??0,C=i.cursosPorPeriodo??[],T=i.cursosDocente??[],A=i.periodosCatalog??[],B=i.sedesCatalog??[],Y=i.areasCatalog??[],N=i.modalidadesCatalog??[],a=M({periodo:((R=i.initialFilters)==null?void 0:R.periodo)??null,sede:((z=i.initialFilters)==null?void 0:z.sede)??null,area_id:((G=i.initialFilters)==null?void 0:G.area_id)??null,modalidad_id:((q=i.initialFilters)==null?void 0:q.modalidad_id)??null}),n=M(i.initialMetrics??null),v=M(!1),P=2*Math.PI*F,ee=f(()=>{var m;const l=(m=n.value)==null?void 0:m.resumen;if(!l)return 0;const s=Number(l.total_cursos??0),x=Number(l.cursos_riesgo??0);return s?Math.round(x/s*100):0}),se=f(()=>{var m;const l=((m=n.value)==null?void 0:m.series_mensuales)??[];if(!l.length)return"";const s=Math.max(...l.map(b=>Number(b.ep_promedio??0)));if(!s)return"";const x=Math.max(l.length-1,1);return l.map((b,_)=>{const h=_/x*100,y=10+(1-Number(b.ep_promedio??0)/s)*70;return`${h},${y}`}).join(" ")}),j=f(()=>A.length?A.map(l=>l.codigo):C.map(l=>l.periodo)),D=f(()=>a.value.area_id?N.filter(l=>String(l.area_id??"")===String(a.value.area_id)):N),V=f(()=>a.value.periodo??j.value[0]??null),oe=f(()=>{const l=V.value;if(!l)return 0;const s=C.find(x=>x.periodo===l);return(s==null?void 0:s.total)??0});ae(()=>a.value.area_id,()=>{a.value.modalidad_id=null}),ne(()=>{!n.value&&k!=="docente"&&$()});function $(){if(k==="docente")return;v.value=!0;const l=new URLSearchParams;a.value.periodo&&l.append("periodo",a.value.periodo),a.value.sede&&l.append("sede",a.value.sede),a.value.area_id&&l.append("area_id",String(a.value.area_id)),a.value.modalidad_id&&l.append("modalidad_id",String(a.value.modalidad_id)),fetch(`/dashboard/metrics?${l.toString()}`,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(s=>s.json()).then(s=>{n.value=s}).finally(()=>{v.value=!1})}function te(){O.get("/cursos")}function de(){O.get("/docents")}return(l,s)=>(t(),ie(pe,{breadcrumbs:J},{default:ue(()=>{var x,m,b,_,h,y;return[e("div",xe,[s[32]||(s[32]=e("div",{class:"mb-8 text-center"},[e("h1",{class:"text-4xl font-extrabold tracking-tight text-primary-foreground drop-shadow"}," Panel general "),e("p",{class:"mt-2 text-sm text-primary-foreground/80"}," Seguimiento de avance por area, modalidad y sede. ")],-1)),u(k)==="docente"?(t(),d("div",me,[s[6]||(s[6]=e("h2",{class:"text-xl font-semibold mb-4"},"Mis cursos",-1)),u(T).length?(t(),d("div",fe,[(t(!0),d(c,null,p(u(T),o=>{var I,L,W,X;return t(),d("div",{key:o.id,class:"bg-card/90 backdrop-blur rounded-2xl border border-white/10 shadow-lg shadow-[#190019]/30 p-4"},[e("div",ge,r(o.codigo)+" - "+r(o.nombre),1),e("div",ve," Área: "+r(o.area??"—")+" · Modalidad: "+r(o.modalidad),1),e("div",_e,"Avance: "+r(o.avance)+"%",1),e("div",he,[e("div",{class:"h-2 bg-green-600 rounded",style:Z({width:`${o.avance}%`})},null,4)]),e("div",ye,[e("span",null,"Actas: "+r(((I=o.faltantes)==null?void 0:I.acta)??0),1),e("span",null,"Guías: "+r(((L=o.faltantes)==null?void 0:L.guia)??0),1),e("span",null,"Present.: "+r(((W=o.faltantes)==null?void 0:W.presentacion)??0),1),e("span",null,"Trabajos: "+r(((X=o.faltantes)==null?void 0:X.trabajo)??0),1)]),e("div",we,[e("button",{class:"p-1",title:"Abrir",onClick:Ns=>l.$inertia.get(`/cursos/${o.id}`)},s[5]||(s[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5 text-primary"},[e("path",{d:"M12 5C5 5 2 12 2 12s3 7 10 7 10-7 10-7-3-7-10-7Zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"})],-1)]),8,ke)])])}),128))])):(t(),d("div",be," No tienes cursos asignados. "))])):(t(),d("div",Ce,[e("div",Pe,[e("div",Me,[s[7]||(s[7]=e("h2",{class:"text-xl font-semibold mb-2"},"Docentes registrados",-1)),e("p",Se,r(u(K)),1)]),e("div",Fe,[s[8]||(s[8]=e("h2",{class:"text-xl font-semibold mb-2"},"Cursos registrados",-1)),e("p",Te,r(u(Q)),1)]),e("div",Ae,[e("div",null,[s[10]||(s[10]=e("h2",{class:"text-xl font-semibold mb-1"},"Cursos por periodo",-1)),e("p",Be,[s[9]||(s[9]=S(" Periodo seleccionado: ")),e("span",Ne,r(V.value),1)]),e("p",je,r(oe.value),1)]),e("div",De,[s[11]||(s[11]=e("span",{class:"font-semibold"},"Resumen periodos:",-1)),(t(!0),d(c,null,p(u(C),o=>(t(),d("span",{key:o.periodo,class:"ml-2"},[S(r(o.periodo)+": ",1),e("span",Ve,r(o.total),1)]))),128))])])]),e("div",$e,[e("div",Ue,[s[12]||(s[12]=e("label",{class:"text-xs text-muted-foreground mb-1"},"Periodo",-1)),g(e("select",{"onUpdate:modelValue":s[0]||(s[0]=o=>a.value.periodo=o),class:"border border-border bg-background text-foreground p-2 rounded min-w-[140px]"},[(t(!0),d(c,null,p(j.value,o=>(t(),d("option",{key:o,value:o},r(o),9,Ee))),128))],512),[[w,a.value.periodo]])]),e("div",Re,[s[14]||(s[14]=e("label",{class:"text-xs text-muted-foreground mb-1"},"Area",-1)),g(e("select",{"onUpdate:modelValue":s[1]||(s[1]=o=>a.value.area_id=o),class:"border border-border bg-background text-foreground p-2 rounded min-w-[160px]"},[s[13]||(s[13]=e("option",{value:""},"Todas",-1)),(t(!0),d(c,null,p(u(Y),o=>(t(),d("option",{key:o.id,value:o.id},r(o.nombre),9,ze))),128))],512),[[w,a.value.area_id]])]),e("div",Ge,[s[16]||(s[16]=e("label",{class:"text-xs text-muted-foreground mb-1"},"Modalidad",-1)),g(e("select",{"onUpdate:modelValue":s[2]||(s[2]=o=>a.value.modalidad_id=o),class:"border border-border bg-background text-foreground p-2 rounded min-w-[180px]"},[s[15]||(s[15]=e("option",{value:""},"Todas",-1)),D.value.length?H("",!0):(t(),d("option",qe,"Sin modalidades")),(t(!0),d(c,null,p(D.value,o=>(t(),d("option",{key:o.id,value:o.id},r(o.nombre),9,Ie))),128))],512),[[w,a.value.modalidad_id]])]),e("div",Le,[s[18]||(s[18]=e("label",{class:"text-xs text-muted-foreground mb-1"},"Sede",-1)),u(B).length?g((t(),d("select",{key:0,"onUpdate:modelValue":s[3]||(s[3]=o=>a.value.sede=o),class:"border border-border bg-background text-foreground p-2 rounded min-w-[160px]"},[s[17]||(s[17]=e("option",{value:""},"Todos",-1)),(t(!0),d(c,null,p(u(B),o=>(t(),d("option",{key:o.id,value:o.nombre},r(o.nombre),9,We))),128))],512)),[[w,a.value.sede]]):g((t(),d("input",{key:1,"onUpdate:modelValue":s[4]||(s[4]=o=>a.value.sede=o),placeholder:"Sede",class:"border border-border bg-background text-foreground p-2 rounded min-w-[160px]"},null,512)),[[ce,a.value.sede]])]),e("button",{type:"button",class:"px-4 py-2 rounded bg-primary text-primary-foreground hover:opacity-90",disabled:v.value,onClick:$},r(v.value?"Actualizando…":"Aplicar filtros"),9,Xe)]),n.value?(t(),d("div",Ze,[e("div",He,[e("div",Oe,[e("div",Je,[(t(),d("svg",Ke,[e("circle",{r:F,cx:"80",cy:"80",class:"stroke-muted","stroke-width":14,fill:"none","stroke-dasharray":P}),e("circle",{r:F,cx:"80",cy:"80",class:"text-primary","stroke-width":14,fill:"none","stroke-linecap":"round","stroke-dasharray":P,"stroke-dashoffset":P*(1-Number(((x=n.value.resumen)==null?void 0:x.avance_promedio)??0)/100),stroke:"currentColor"},null,8,Qe)])),e("div",Ye,[s[19]||(s[19]=e("div",{class:"text-xs text-muted-foreground"},"Avance promedio",-1)),e("div",es,r(((m=n.value.resumen)==null?void 0:m.avance_promedio)??0)+"% ",1),e("div",ss,r(n.value.sede??"Todas las sedes")+" · "+r(n.value.periodo),1)])]),e("div",os,[e("div",ts,[s[20]||(s[20]=e("span",{class:"text-muted-foreground mb-1"},"Total cursos",-1)),e("span",ds,r(((b=n.value.resumen)==null?void 0:b.total_cursos)??0),1)]),e("div",rs,[s[21]||(s[21]=e("span",{class:"text-muted-foreground mb-1"},"En riesgo (< 60%)",-1)),e("span",ls,r(ee.value)+"% ",1)])])]),e("div",as,[s[22]||(s[22]=e("h3",{class:"text-sm font-semibold mb-2"},"Top 5 con menor avance",-1)),(_=n.value.top_riesgo)!=null&&_.length?(t(),d("ul",is,[(t(!0),d(c,null,p(n.value.top_riesgo,o=>(t(),d("li",{key:o.id,class:"flex justify-between items-center"},[e("div",us,[e("div",cs,r(o.codigo)+" - "+r(o.nombre),1),e("div",ps,r(o.responsable??"Sin responsable"),1)]),e("div",xs,[e("div",ms,r(o.avance)+"%",1)])]))),128))])):(t(),d("div",ns," No hay cursos para este filtro. "))])]),e("div",bs,[s[23]||(s[23]=e("h3",{class:"text-sm font-semibold mb-2"},"Avance por responsable",-1)),(h=n.value.por_responsable)!=null&&h.length?(t(),d("div",gs,[(t(!0),d(c,null,p(n.value.por_responsable,o=>(t(),d("div",{key:o.responsable_id,class:"text-xs space-y-1"},[e("div",vs,[e("span",_s,r(o.responsable),1),e("span",hs,r(o.cursos)+" cursos",1)]),e("div",ys,[e("div",{class:"h-2 rounded bg-purple-400",style:Z({width:`${o.avance_promedio??0}%`})},null,4)]),e("div",ws," Avance medio: "+r(o.avance_promedio??0)+"% ",1)]))),128))])):(t(),d("div",fs," No hay datos de responsables para este filtro. "))]),e("div",ks,[s[30]||(s[30]=e("h3",{class:"text-sm font-semibold mb-2"},"Serie mensual (EP promedio)",-1)),(y=n.value.series_mensuales)!=null&&y.length?(t(),d("div",Ps,[e("div",Ms,[(t(),d("svg",Ss,[s[24]||(s[24]=e("defs",null,[e("linearGradient",{id:"lineGradient",x1:"0",y1:"0",x2:"1",y2:"0"},[e("stop",{offset:"0%","stop-color":"#FBE4D8"}),e("stop",{offset:"50%","stop-color":"#DFB6B2"}),e("stop",{offset:"100%","stop-color":"#854F6C"})])],-1)),s[25]||(s[25]=e("rect",{x:"0",y:"10",width:"100",height:"80",rx:"6",class:"fill-muted/40"},null,-1)),s[26]||(s[26]=e("line",{x1:"8",y1:"80",x2:"92",y2:"80",class:"stroke-muted-foreground","stroke-width":"0.5"},null,-1)),s[27]||(s[27]=e("line",{x1:"8",y1:"80",x2:"8",y2:"20",class:"stroke-muted-foreground","stroke-width":"0.5"},null,-1)),e("polyline",{points:se.value,fill:"none",stroke:"url(#lineGradient)","stroke-width":"2"},null,8,Fs),s[28]||(s[28]=e("text",{x:"50",y:"94","text-anchor":"middle",class:"fill-muted-foreground","font-size":"6"}," Mes ",-1)),s[29]||(s[29]=e("text",{x:"4",y:"50","text-anchor":"middle",transform:"rotate(-90 4,50)",class:"fill-muted-foreground","font-size":"6"}," Promedio EP ",-1))]))]),e("div",Ts,[(t(!0),d(c,null,p(n.value.series_mensuales,o=>(t(),d("span",{key:o.mes},[S(r(o.mes)+": ",1),e("span",As,r(o.ep_promedio),1)]))),128))])])):(t(),d("div",Cs," Aún no hay registros de notas para este periodo/filtro. "))])])):H("",!0),e("div",{class:"bg-card/90 backdrop-blur p-6 rounded-2xl shadow-lg shadow-[#190019]/30 border border-white/10"},[s[31]||(s[31]=e("h2",{class:"text-xl font-semibold mb-2"},"Acceso rápido",-1)),e("div",{class:"flex flex-wrap gap-4"},[e("button",{onClick:de,class:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition"}," Ver docentes "),e("button",{onClick:te,class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"}," Ver cursos ")])])]))])]}),_:1}))}});export{Us as default};
